<?php session_start();if(!isset($_SESSION['status']) && $_SESSION['status']!="admin"){	Header("Location: ../");}include("../../../bd.php");	class img	{		private $image;		private $ox;		private $oy;		private $ny;		private $final_width_of_image=180;		private $nm;		private $fname;				public function dovar()		{			$this->ox=imagesx($this->image);			$this->oy=imagesy($this->image);			$this->ny=floor($this->oy * ($this->final_width_of_image / $this->ox));			$this->nm=imagecreatetruecolor($this->final_width_of_image, $this->ny);		}				public function __construct($filename)		{			switch($this->getextension($filename))			{				case "jpg":$this->image=imagecreatefromjpeg($filename);break;				case "jpeg":$this->image=imagecreatefromjpeg($filename);break;				case "png":$this->image=imagecreatefrompng($filename);break;				case "gif":$this->image=imagecreatefromgif($filename);break;				case "JPG":$this->image=imagecreatefromgif($filename);break;				case "JPEG":$this->image=imagecreatefromgif($filename);break;				case "PNG":$this->image=imagecreatefromgif($filename);break;				case "GIF":$this->image=imagecreatefromgif($filename);break;				default:die("Запрещенный вид картинки!");break;			}			$this->fname=$filename;			$this->dovar();		}				public function getextension($filename)		{			return array_pop(explode(".",$filename));		}				public function resize()		{			imagecopyresampled($this->nm, $this->image, 0,0,0,0,$this->final_width_of_image,$this->ny,$this->ox,$this->oy);			if(imagejpeg($this->nm,$this->fname))return true;else return false;		}	}		if(isset($_FILES['fon']['tmp_name']) && isset($_POST['category']))	{	if(is_uploaded_file($_FILES['fon']['tmp_name']))	{		function getextension($filename)		{			return array_pop(explode(".",$filename));		}		 $randnumber=rand(111111,999999);		 $smallname=$randnumber.".".getextension($_FILES['fon']['name']);		 $fnamer="../../../temps/small/".$randnumber.".".getextension($_FILES['fon']['name']);		 $res=mysql_query("SELECT `temp_count` FROM `config` WHERE `id`=1 ");		 $tempdata=mysql_fetch_array($res);		 $numberoftemp=$tempdata['temp_count']+1;		 $res=mysql_query("UPDATE `config` SET `temp_count`='$numberoftemp' WHERE `id`=1 ");		 $postname=$randnumber.".".getextension($_FILES['fon']['name']);		 $fonfnamer="../../../temps/postcards/".$randnumber.".".getextension($_FILES['fon']['name']);		 move_uploaded_file($_FILES['fon']['tmp_name'],$fonfnamer);		 copy($fonfnamer,$fnamer);		 		 $imgres=new img($fnamer);		 $req=$imgres->resize();		 $categoryoftemp=$_POST['category'];		 $result=mysql_query		 ("INSERT INTO `templates` (`category`,`postcard`) 		 VALUES ('$categoryoftemp','$postname')");		 		 if($req)		 {		 echo "Файл ".$_FILES['fon']['name']." успешно загружен и уменьшен!<br><br><b>Результат:</b><br><br>";		 echo "<img src=".$fnamer."></img><br><br>";		 echo "<a href='../../index.php?act=uptemp'>Назад в загрузку шаблонов</a>";		 }	}	else echo "Вы должны загрузить все файлы!";	}	else	{		die("Вы должны загрузить все файлы!");	}?>